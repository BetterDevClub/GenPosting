@using MudBlazor

<MudPaper Class="pa-4 rounded-lg" Elevation="0" Style="background-color: #1b1f23; border: 1px solid #30363d; color: white;">
    <!-- Tools Header -->
    <div class="d-flex justify-space-between align-center mb-4">
        <div class="d-flex align-center gap-2">
            <MudText Typo="Typo.subtitle2" Style="font-weight: 600;">Post Preview</MudText>
            <MudTooltip Text="This is a preview of how your post will appear on Instagram.">
                <MudIcon Icon="@Icons.Material.Filled.Info" Size="Size.Small" Style="color: #8b949e; font-size: 1rem;" />
            </MudTooltip>
        </div>
        
        <div class="d-flex align-center gap-2">
             <MudPaper Class="d-flex align-center px-2 py-1 rounded" Style="background-color: #21262d; border: 1px solid #30363d;">
                <MudIcon Icon="@Icons.Custom.Brands.Instagram" Size="Size.Small" Color="Color.Secondary" Class="mr-2" />
                <MudText Typo="Typo.caption" Style="color: #c9d1d9;">Instagram</MudText>
                <MudIcon Icon="@Icons.Material.Filled.KeyboardArrowDown" Size="Size.Small" Style="color: #8b949e;" />
             </MudPaper>

             <MudButtonGroup OverrideStyles="false" Class="rounded border-0">
                 <MudIconButton Icon="@Icons.Material.Filled.DesktopMac" Size="Size.Small" 
                               Style="@(IsMobile ? "color: #484f58;" : "color: #c9d1d9; background-color: #21262d;")" 
                               OnClick="@(() => IsMobile = false)" />
                 <MudIconButton Icon="@Icons.Material.Filled.Smartphone" Size="Size.Small" 
                               Style="@(IsMobile ? "color: #c9d1d9; background-color: #21262d;" : "color: #484f58;")" 
                               OnClick="@(() => IsMobile = true)" />
             </MudButtonGroup>
        </div>
    </div>

    <!-- The Instagram Card -->
    <!-- Max width simulates feed width. Mobile is narrower. -->
    <MudPaper Class="mx-auto overflow-hidden" 
              Elevation="0" 
              Style="@($"background-color: #000000; border: 1px solid #262626; border-radius: 3px; max-width: {(IsMobile ? "350px" : "470px")}; transition: max-width 0.3s ease;")">
        
        <!-- IG Post Header -->
        <div class="pa-3 d-flex align-center gap-3">
             @if (!string.IsNullOrEmpty(AuthorAvatarUrl))
             {
                 <MudAvatar Image="@AuthorAvatarUrl" Size="Size.Small" Style="border: 1px solid #363636;" />
             }
             else
             {
                 <MudAvatar Color="Color.Secondary" Size="Size.Small">@AuthorName.FirstOrDefault()</MudAvatar>
             }

             <div class="d-flex flex-column justify-center">
                 <MudText Typo="Typo.subtitle2" Style="font-weight: 600; font-size: 14px; color: #f5f5f5;">@AuthorName</MudText>
                 @if(!string.IsNullOrEmpty(Location))
                 {
                    <MudText Typo="Typo.caption" Style="font-size: 11px; color: #a8a8a8;">@Location</MudText>
                 }
             </div>
             
             <MudSpacer />
             
             <MudIconButton Icon="@Icons.Material.Filled.MoreHoriz" Size="Size.Small" Style="color: #f5f5f5;" />
        </div>

        <!-- Media Area -->
        <div style="background-color: #1a1a1a; min-height: 200px; display: flex; align-items: center; justify-content: center;">
            @if (Images != null && Images.Any())
            {
                @if (Images.Count == 1)
                {
                    <MudImage Src="@Images[0]" Fluid="true" Class="w-100" Style="display: block;" />
                }
                else
                {
                    <MudCarousel Class="mud-width-full" Style="height:400px;" ShowArrows="true" ShowBullets="true" AutoCycle="false" TData="object">
                        @foreach (var img in Images)
                        {
                            <MudCarouselItem Transition="Transition.Fade"> <!-- IG is swipe, Fade is closer than slide for this generic component -->
                                <div class="d-flex justify-center align-center" style="height:100%; bg-color:#000;">
                                    <MudImage Src="@img" Fluid="true" Style="max-height:100%; max-width:100%;" />
                                </div>
                            </MudCarouselItem>
                        }
                    </MudCarousel>
                }
            }
            else if (!string.IsNullOrEmpty(VideoUrl))
            {
                 <video controls style="width: 100%; max-height: 500px; background-color: black;">
                    <source src="@VideoUrl" type="video/mp4">
                    Your browser does not support the video tag.
                 </video>
            }
            else
            {
                <div class="d-flex flex-column align-center justify-center p-4">
                     <MudIcon Icon="@Icons.Material.Outlined.Image" Size="Size.Large" Style="color: #404040; font-size: 64px;" />
                     <MudText Typo="Typo.caption" Style="color: #404040;">Media Preview</MudText>
                </div>
            }
        </div>

        <!-- Action Bar -->
        <div class="px-3 pt-2 pb-2 d-flex gap-4">
            <MudIcon Icon="@Icons.Material.Outlined.FavoriteBorder" Style="color: #f5f5f5; cursor: pointer;" Size="Size.Medium" />
            <MudIcon Icon="@Icons.Material.Outlined.ChatBubbleOutline" Style="color: #f5f5f5; cursor: pointer;" Size="Size.Medium" />
            <MudIcon Icon="@Icons.Material.Outlined.Send" Style="color: #f5f5f5; cursor: pointer;" Size="Size.Medium" />
            <MudSpacer />
            <MudIcon Icon="@Icons.Material.Outlined.BookmarkBorder" Style="color: #f5f5f5; cursor: pointer;" Size="Size.Medium" />
        </div>
        
        <!-- Post Body and Comments -->
        <div class="px-3 pb-3">
            <MudText Typo="Typo.subtitle2" Style="color: #f5f5f5; font-weight: 600; margin-bottom: 4px;">12 likes</MudText>
            
            <div class="mb-2">
                @if (!string.IsNullOrWhiteSpace(Content))
                {
                    <MudText Typo="Typo.body2" Style="white-space: pre-wrap; color: #f5f5f5; font-size: 14px; font-family: -apple-system,system-ui,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;">
                        <span style="font-weight: 600; margin-right: 6px;">@AuthorName</span>@Content
                    </MudText>
                }
                else
                {
                    <MudText Typo="Typo.body2" Style="color: #7d8590; font-style: italic;">No caption yet.</MudText>
                }
            </div>

            @if(Comments != null && Comments.Any())
            {
                 <MudText Typo="Typo.caption" Style="color: #a8a8a8; cursor: pointer; display: block; margin-bottom: 4px;">View all comments</MudText>
                 @foreach(var comment in Comments.Take(2))
                 {
                     <MudText Typo="Typo.caption" Style="display: block; color: #f5f5f5;">
                         <span style="font-weight: 600; margin-right: 4px;">user123</span> @comment
                     </MudText>
                 }
            }

            <MudText Typo="Typo.caption" Style="color: #a8a8a8; font-size: 10px; margin-top: 4px; display: block; text-transform: uppercase;">2 HOURS AGO</MudText>
        </div>

    </MudPaper>
</MudPaper>

@code {
    [Parameter] public string? AuthorName { get; set; } = "Your Account";
    [Parameter] public string? AuthorAvatarUrl { get; set; }
    [Parameter] public string? Content { get; set; }
    [Parameter] public List<string>? Images { get; set; }
    [Parameter] public string? VideoUrl { get; set; }
    [Parameter] public string? Location { get; set; }
    [Parameter] public List<string>? Comments { get; set; }

    private bool IsMobile { get; set; } = false;
}
